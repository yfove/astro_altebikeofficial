---
import "../styles/blog.css";
import "../styles/global.css";
import Header from "../components/header4.astro";
import Footer from "../components/footer2.astro";
import Accordian from "../components/accordian.astro";
import Sidebar from "../components/sidebar.astro";
import Cta from "../components/cta.astro";
import Horizontalbar from "~/components/horizontalbar-guides.astro";
import Horizontalbar2 from "~/components/horizontalbar.astro";
import PostViews from "~/components/PostViews.astro";
import Related from "../components/RelatedProducts.astro"; // Import the new component


const { minutesRead } = Astro.props.frontmatter;
const {
frontmatter: {
title,
description,
pubDate,
pubTime,
image,
author,
credit,
slug,
buyLink,
product,
tags,
price,
},
} = Astro.props;

export const prerender = true;

// Use Astro.glob to fetch all the posts
const contentItems = await Astro.glob("../pages/{post,products}/**/*.mdx");

// Ensure there are tags and get the first one
const firstTag = tags && tags.length > 0 ? tags[0] : null;

// Ensure there are tags
const relatedPosts = contentItems
.filter(
(post) =>
post.frontmatter.slug !== slug && // Exclude the current post
post.frontmatter.tags.some((tag) => tags.includes(tag)) // Check if any tag matches
)
.sort(() => Math.random() - 0.5) // Shuffle the posts randomly
.slice(0, 4); // Display only 4 posts
---

<html lang="en" class="scroll-smooth">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="icon" href="/logo.png" type="image/svg+xml" />
  <title>{title} | Your Blog</title>
</head>

<body class="bg-black text-gray-200 font-sans">
  <Header />

  <div class="container mx-auto px-6 py-12 max-w-5xl flex flex-col lg:flex-row gap-12">
    <main class="flex-1 prose prose-invert max-w-none">
      <nav aria-label="Breadcrumb" class="mb-4 text-sm text-gray-400 flex flex-wrap gap-2">
        <a href="/" class="gradient-text hover:underline">Home</a>
        <span>/</span>
        <!-- <a href="/posts" class="gradient-text hover:underline">Blog</a>
        <span>/</span> -->
        <span aria-current="page" class="text-gray-500 truncate max-w-xs">{title}</span>
      </nav>

      <nav class="mb-6 text-sm font-medium">
        <a href="javascript:history.back()" class="gradient-text underline hover:opacity-80 transition">
          ← Back
        </a>
      </nav>

      <article>
        <h1 class="gradient-text text-4xl font-extrabold mb-6 leading-tight">{title}</h1>

        <div class="flex flex-wrap items-center text-gray-400 text-sm space-x-8 mb-8">
          <div class="flex items-center space-x-2" title="Author">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24"
              stroke="currentColor" stroke-width="2" aria-hidden="true" role="img" focusable="false">
              <path stroke-linecap="round" stroke-linejoin="round"
                d="M12 12c2.28 0 4-1.72 4-4s-1.72-4-4-4-4 1.72-4 4 1.72 4 4 4zM12 14c-3 0-6 1.5-6 4.5V20h12v-1.5c0-3-3-4.5-6-4.5z" />
            </svg>
            <span>{author}</span>
          </div>

          <div class="flex items-center space-x-2" title="Reading Time">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-400" fill="none" viewBox="0 0 24 24"
              stroke="currentColor" stroke-width="2" aria-hidden="true" role="img" focusable="false">
              <path stroke-linecap="round" stroke-linejoin="round" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            <span>{minutesRead} </span>
          </div>

          <PostViews slug={slug} />
        </div>

        {image && (
        <figure class="mb-8">
          <img src={image} alt={title} class="rounded-lg shadow-lg w-full object-cover max-h-96" />
          {credit && (
          <figcaption class="text-xs text-gray-500 mt-2 italic">
            {credit}
          </figcaption>
          )}
        </figure>
        )}

        <time dateTime={pubDate} class="block mb-2 text-xs text-gray-500">
          Published on {pubTime} • {pubDate}
        </time>

        {tags && tags.length > 0 && (
        <div class="mb-6 flex flex-wrap gap-2">
          {tags.map((tag) => (
          <a href={`/tags/${tag.toLowerCase().replace(/\s+/g, "-" )}`} key={tag}
            class="inline-block bg-gradient-to-r from-purple-900 via-purple-800 to-purple-700 text-white text-xs font-medium px-3 py-1 rounded-full shadow-sm hover:brightness-90 transition">
            {tag}
          </a>
          ))}
        </div>
        )}



        {description && (
        <p class="mb-4 text-gray-400 italic text-lg max-w-prose">
          {description}
        </p>
        )}

        <section class="blog-article text-md leading-[1.8] text-gray-200 max-w-3xl mx-auto ">
          <slot />
        </section>

        {buyLink && (
        <div class="mt-12">
          <div class="text-2xl font-bold text-white mb-4">
            ${price.toLocaleString(undefined, { minimumFractionDigits: 2 })} MSRP
          </div>
          <a href={buyLink}
            class="inline-block rounded bg-gradient-to-r from-pink-500 via-red-500 to-yellow-500 text-black px-6 py-3 font-semibold shadow-lg hover:brightness-110 transition"
            target="_blank" rel="noopener noreferrer">
            Buy the {product}
          </a>
        </div>
        )}

      </article>

      <div class="tags mt-8 pt-6 border-t border-gray-200">
        <h2 class="mb-3 text-sm font-semibold text-gray-700 uppercase tracking-wide">
          Explore Topics
        </h2>
        {tags && tags.length > 0 && (
        <div class="flex flex-wrap gap-3">
          {tags.map((tag) => (
          <a key={tag} href={`/tags/${tag.toLowerCase().replace(/\s+/g, "-" )}`}
            class="inline-block text-sm font-semibold text-gray-700 border border-gray-700 rounded-full px-4 py-1 hover:bg-gray-900 hover:text-white transition">
            {tag}
          </a>
          ))}
        </div>
        )}
      </div>



      <nav class="mt-12 flex gap-4 text-sm font-medium">
        <a href="javascript:history.back()" class="gradient-text underline hover:opacity-80 transition">
          ← Back
        </a>
        <span class="text-gray-600">|</span>
        <a href="/" class="gradient-text underline hover:opacity-80 transition">
          Home
        </a>
      </nav>




      <Related tags={tags} relatedPosts={relatedPosts} />





    </main>

    <aside class="hidden lg:block w-80 sticky top-24 self-start">
      <Sidebar />
    </aside>
  </div>

  <Accordian />
  <Cta />
  <Horizontalbar2 />
  <Horizontalbar />

  <Footer />
</body>

</html>