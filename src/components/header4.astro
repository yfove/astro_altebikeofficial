---
import { Icon } from "astro-icon";
import NavSidebar from "../components/NavSidebar.astro";

const allPosts = await Astro.glob("../pages/post/**/*.mdx");

const tags = [
...new Set(
allPosts.flatMap((post) =>
(post.frontmatter.tags || []).map((tag) => tag.toLowerCase())
)
),
];
const limitedTags = tags.slice(0, 12);

const categories = [
{
title: "Popular Tags",
items: limitedTags,
},
];

function formatTagDisplay(tag) {
return tag
.replace(/-/g, " ")
.replace(/\b\w/g, (c) => c.toUpperCase());
}
---

<nav class="sticky top-0 z-50 bg-black border-b border-zinc-950 text-white px-3 py-2">
  <NavSidebar categories={categories} />

  <!-- Logo and menu toggle -->
  <div class="container mx-auto max-w-6xl flex items-center justify-start py-1 px-4">
    <button id="open-menu" class="mr-4 flex items-center justify-center w-10 h-10 focus:outline-none"
      aria-label="Open sidebar menu">
      <svg class="w-6 h-6 stroke-white" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"
        stroke-linecap="round" stroke-linejoin="round">
        <line x1="3" y1="6" x2="21" y2="6" />
        <line x1="3" y1="12" x2="21" y2="12" />
        <line x1="3" y1="18" x2="21" y2="18" />
      </svg>
    </button>

    <a href="/">
      <Icon name="ebikenook" class="h-16 w-16" />
    </a>
    <a href="/" class="flex-1 font-extrabold text-white text-2xl leading-none select-none">ebikenook</a>
  </div>

  <!-- Unified Horizontal Nav -->
  <div class="container mx-auto max-w-6xl px-4 hidden md:block">
    <ul class="flex flex-row flex-nowrap items-center gap-2 font-semibold text-sm">

      <!-- Dropdown: E-Vault -->
      <li class="relative group text-zinc-400">
        <a href="/products/" class="flex items-center px-3 py-2 hover:text-[#818cf8]">
          E-Vault
          <svg class="ml-1 h-4 w-4 stroke-[#FF00FF]" fill="none" viewBox="0 0 20 20" stroke-width="1.25">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 7.5L10 12.5L15 7.5" />
          </svg>
        </a>
        <ul
          class="absolute left-0 top-full mt-1 w-40 rounded bg-zinc-900 shadow-lg opacity-0 group-hover:opacity-100 pointer-events-none group-hover:pointer-events-auto transition-opacity duration-200 z-50">
          <li><a href="/products/" class="block px-4 py-2 hover:bg-zinc-800">Ebikes</a></li>
          <li><a href="https://gearwelt.com/" target="_blank" class="block px-4 py-2 hover:bg-zinc-800">Gear</a></li>
          <li>
            <p class="block px-4 py-2 hover:bg-zinc-800">Wildlands (coming soon)</p>
          </li>
          <li><a href="/products/" class="block border-t border-zinc-700 px-4 py-2 font-semibold hover:bg-zinc-800">All
              reviews</a></li>
        </ul>
      </li>
      <!-- Dropdown: Electric Pulse -->
      <li class="relative group text-zinc-400">
        <a href="/post/" class="flex items-center px-3 py-2 hover:text-[#818cf8]">
          Electric Pulse
          <svg class="ml-1 h-4 w-4 stroke-[#FF00FF]" fill="none" viewBox="0 0 20 20" stroke-width="1.25">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 7.5L10 12.5L15 7.5" />
          </svg>
        </a>
        <ul
          class="absolute left-0 top-full mt-1 w-40 rounded bg-zinc-900 shadow-lg opacity-0 group-hover:opacity-100 pointer-events-none group-hover:pointer-events-auto transition-opacity duration-200 z-50">
          {limitedTags.map((tag) => (
          <li key={tag}>
            <a href={`/tags/${tag.replace(/\s+/g, "-" )}`} class="block px-4 py-2 hover:bg-zinc-800">
              {formatTagDisplay(tag)}
            </a>
          </li>
          ))}
          <li>
            <a href="/post/" class="block border-t border-zinc-700 px-4 py-2 font-semibold hover:bg-zinc-800">All
              news</a>
          </li>
        </ul>
      </li>



      <!-- Dropdown: Features -->
      <li class="relative group text-zinc-400">
        <p class="flex items-center px-3 py-2 hover:text-[#818cf8] cursor-pointer select-none">
          Features
          <svg class="ml-1 h-4 w-4 stroke-[#FF00FF]" fill="none" viewBox="0 0 20 20" stroke-width="1.25">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 7.5L10 12.5L15 7.5" />
          </svg>
        </p>
        <ul
          class="absolute left-0 top-full mt-1 w-48 rounded bg-zinc-900 shadow-lg opacity-0 group-hover:opacity-100 pointer-events-none group-hover:pointer-events-auto transition-opacity duration-200 z-50">
          <li>
            <p class="block px-4 py-2 hover:bg-zinc-800">Racing (coming soon)</p>
          </li>
          <li><a href="/features/" class="block border-t border-zinc-700 px-4 py-2 font-semibold hover:bg-zinc-800">All
              Features</a></li>
        </ul>
      </li>

      <!-- Simple Links: Home / Guides / GearWelt -->
      <li><a href="/" class="px-3 py-2 text-white text-xs hover:text-[#818cf8]">Home</a></li>
      <li><a href="/guides" class="px-3 py-2 text-white text-xs hover:text-[#818cf8]">Guides</a></li>
      <li><a href="https://gearwelt.com/" target="_blank"
          class="px-3 py-2 text-white text-xs hover:text-[#818cf8]">GearWelt</a></li>

      </li>
    </ul>
  </div>
</nav>

<script>
  const openMenuBtn = document.getElementById("open-menu");
  const sideMenu = document.getElementById("side-menu");
  const closeMenuBtn = document.getElementById("close-menu");

  openMenuBtn?.addEventListener("click", () => {
    sideMenu.classList.replace("w-0", "w-72");
    closeMenuBtn.classList.remove("hidden");
  });
</script>