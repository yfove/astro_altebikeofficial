---
const allPosts = await Astro.glob("../pages/post/*.mdx");
const tags = [
...new Set(
allPosts.flatMap((post) =>
(post.frontmatter.tags || []).map((tag) => tag.toLowerCase())
)
),
];
const maxVisibleTags = 20;

function formatTagDisplay(tag) {
return tag
.toLowerCase()
.replace(/-/g, ' ')
.replace(/\b\w/g, (c) => c.toUpperCase());
}
---

<div class="tags flex flex-wrap justify-center gap-2 my-4 mx-auto ">
  {
  tags
  .sort((a, b) => a.localeCompare(b))
  .slice(0, maxVisibleTags)
  .map((tag) => (
  <p key={tag} class="tag border-2 rounded-lg border-fuchsia-900 px-4 py-1 text-white text-sm hover:text-gray-100">
    <a href={`/tags/${tag.replace(/\s+/g, "-" )}`} class="font-sans font-normal gradient-text">
      {formatTagDisplay(tag)}
    </a>
  </p>
  ))
  }

  {
  tags.length > maxVisibleTags && (
  <div class="relative z-10">
    <button id="dropdownToggle"
      class="tag cursor-pointer rounded-lg border-2 border-fuchsia-800 bg-secondary px-4 py-1 font-bold gradient-text text-sm hover:text-gray-100">
      Browse more topics...
    </button>

    <div id="dropdownContent"
      class="dropdown-content absolute z-10 mt-1 hidden w-full border-2 rounded-lg border-fuchsia-900 bg-black p-2 shadow-lg max-h-96 overflow-y-auto">
      {tags.slice(maxVisibleTags).map((tag) => (
      <p key={tag}
        class="tag border-2 border-fuchsia-900 bg-secondary p-2 my-2 rounded-lg font-bold gradient-text text-sm hover:text-gray-100">
        <a href={`/tags/${tag.replace(/\s+/g, "-" )}`} class="font-sans font-bold">
          {formatTagDisplay(tag)}
        </a>
      </p>
      ))}
    </div>
  </div>
  )
  }
</div>

<script>
  const dropdownToggle = document.getElementById("dropdownToggle");
  const dropdownContent = document.getElementById("dropdownContent");

  dropdownToggle.addEventListener("click", () => {
    dropdownContent.classList.toggle("hidden");
  });
</script>