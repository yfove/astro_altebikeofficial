---
import BlogLayout from "../../layouts/BlogLayout.astro";
import Alltags from "~/components/alltags.astro";
import PostViews from "~/components/PostViews.astro";
import SearchBar from "~/components/SearchBar.astro";
import TopDouble from "~/components/topdouble.astro";
import TopQuadriple from "~/components/topquadriple.astro";
import PaginatedComponent from "~/components/PaginatedComponentPosts.astro";
import AdHorizontal from "~/components/adhorizontal.astro";

export async function getStaticPaths({ paginate }) {
const post = await Astro.glob("./*.mdx");

const sortedPosts = post.sort((a, b) => {
const aDate = new Date(a.frontmatter.pubDate);
const bDate = new Date(b.frontmatter.pubDate);
return bDate - aDate;
});

return paginate(sortedPosts, { pageSize: 6, page: 1 });
}

const { page } = Astro.props;
---

<BlogLayout title="Electric Pulse"
  description="Stay informed with articles highlighting the latest developments, trends, and regulations in the eBike worldâ€”ensuring riders are prepared for the changes shaping their rides and the future of sustainable transportation.">

  <!-- Mobile-tight section wrapper -->
  <section class="max-w-[100vw] mx-auto px-1 sm:px-4 py-4 sm:py-8 space-y-6 sm:space-y-10">

    <div class="flex flex-col lg:flex-row gap-4 sm:gap-8">

      <!-- Sidebar -->
      <aside
        class="w-full lg:w-1/4 lg:sticky lg:top-20 self-start space-y-4 sm:space-y-6 p-3 sm:p-4 rounded-lg border border-zinc-800 shadow-md bg-zinc-950 text-white">

        <!-- Search -->
        <div>
          <h2 class="mb-3 text-lg font-bold border-b border-fuchsia-700 pb-2">Search Articles</h2>
          <SearchBar />
        </div>

        <!-- Tags -->
        <div>
          <h2 class="mb-3 text-lg font-bold border-b border-fuchsia-700 pb-2">Explore Topics</h2>
          <Alltags />
        </div>

        <!-- Trending -->
        <div>
          <h2 class="mb-3 text-lg font-bold border-b border-fuchsia-700 pb-2">Trending Now</h2>

          {page.data
          .filter(post => post.frontmatter.tags?.includes("Trends"))
          .slice(0, 3)
          .map(post => (
          <article key={post.frontmatter.slug}
            class="group rounded-lg overflow-hidden shadow-md hover:shadow-lg transition-shadow duration-300 mb-4">
            <a href={`/post/${post.frontmatter.slug}`} class="block relative">
              <div class="aspect-w-16 aspect-h-9 overflow-hidden rounded-md">
                <img src={post.frontmatter.image} alt={post.frontmatter.title}
                  class="object-cover w-full h-full transform group-hover:scale-105 transition-transform duration-300"
                  loading="lazy" />
              </div>
              <div
                class="p-3 bg-gradient-to-t from-zinc-900 via-transparent absolute bottom-0 left-0 right-0 text-white">
                <h3 class="text-lg font-semibold leading-tight mb-1 line-clamp-2">
                  {post.frontmatter.title}
                </h3>
                <p class="text-xs text-gray-400 mb-1 line-clamp-2">
                  {post.frontmatter.description}
                </p>
                <div class="flex justify-between text-xs font-light opacity-75">
                  <time>{post.frontmatter.pubDate}</time>
                  <span>
                    &#10711; {post.frontmatter.minutesRead} min read
                    <PostViews slug={post.frontmatter.slug} />
                  </span>
                </div>
              </div>
            </a>
          </article>
          ))}
        </div>

        <!-- Newsletter -->
        <div class="p-3 sm:p-4 bg-zinc-900 rounded text-center text-sm">
          <p class="mb-2 font-semibold">Follow Us on Instagram</p>
          <p class="mb-4">
            Get the latest eBike updates, tips, and community vibes on{" "}
            <strong>@ebikenook</strong>.
          </p>
          <a href="https://www.instagram.com/ebikenook" target="_blank" rel="noopener noreferrer"
            class="inline-block rounded bg-white px-3 py-1 text-fuchsia-900 font-bold hover:bg-gray-200 transition">
            Follow @ebikenook
          </a>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="lg:w-3/4 space-y-6 sm:space-y-8">

        <!-- Featured Post -->
        {
        page.data
        .filter(post => post.frontmatter.tags?.includes("Trends"))
        .slice(0, 1)
        .map(post => (
        <article key={post.frontmatter.slug}
          class="relative group rounded-xl overflow-hidden shadow-lg hover:shadow-2xl transition-shadow duration-300">
          <a href={`/post/${post.frontmatter.slug}`} class="block">
            <div class="aspect-w-16 aspect-h-9">
              <img src={post.frontmatter.image} alt={post.frontmatter.title}
                class="object-cover w-full h-full transform group-hover:scale-105 transition-transform duration-300"
                loading="lazy" />
            </div>
            <div
              class="p-4 sm:p-6 bg-gradient-to-t from-zinc-900 via-transparent absolute bottom-0 left-0 right-0 text-white">
              <h2 class="text-2xl sm:text-3xl font-extrabold leading-tight mb-2">
                {post.frontmatter.title}
              </h2>
              <p class="text-sm text-gray-300 mb-2">
                {post.frontmatter.description}
              </p>
              <div class="flex justify-between text-xs font-light opacity-75">
                <time>{post.frontmatter.pubDate}</time>
                <span>
                  &#10711; {post.frontmatter.minutesRead} min read
                  <PostViews slug={post.frontmatter.slug} />
                </span>
              </div>
            </div>
          </a>
        </article>
        ))
        }

        <!-- Secondary Posts -->
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 sm:gap-6">
          {
          page.data
          .filter(post =>
          post.frontmatter.tags?.some(tag => ["Trends", "Urbanism"].includes(tag))
          )
          .slice(1, 5)
          .map(post => (
          <article key={post.frontmatter.slug}
            class="flex flex-col rounded-lg border border-zinc-800 hover:border-primary-600 transition-colors duration-300 overflow-hidden shadow-sm">
            <a href={`/post/${post.frontmatter.slug}`} class="flex flex-col flex-grow">
              <div class="aspect-w-16 aspect-h-9">
                <img src={post.frontmatter.image} alt={post.frontmatter.title} class="object-cover w-full h-full"
                  loading="lazy" />
              </div>
              <div class="p-4 flex flex-col flex-grow">
                <h3 class="text-lg font-semibold mb-1">{post.frontmatter.title}</h3>
                <p class="text-gray-400 text-sm mb-3 line-clamp-3">{post.frontmatter.excerpt}</p>
                <div class="mt-auto flex justify-between text-xs font-light text-gray-500">
                  <time>{post.frontmatter.pubDate}</time>
                  <span>
                    &#10711; {post.frontmatter.minutesRead} min
                    <PostViews slug={post.frontmatter.slug} />
                  </span>
                </div>
              </div>
            </a>
          </article>
          ))}
        </div>

        <!-- Ads / Extra Content -->
        <AdHorizontal />
        <TopDouble />
        <TopQuadriple />
        <PaginatedComponent page={page} posts={page.data} />

      </main>
    </div>
  </section>
</BlogLayout>